# 关键词回复配置功能说明

## 🎉 新增功能完成！

✅ **已为GUI添加完整的关键词回复配置页面**

## 📋 功能特性

### 🎯 三种匹配模式

#### 1. **精确匹配**
- 用户消息必须完全匹配关键词
- 适用于固定的问候语、简单回复
- 示例：
  ```
  关键词: "你好"
  回复: ["你好！", "嗨！", "哈喽"]
  ```

#### 2. **包含匹配**
- 用户消息包含关键词即可触发
- 适用于话题检测、内容分类
- 示例：
  ```
  关键词: "工作"
  回复: ["上班族", "搬砖去", "工作辛苦"]
  ```

#### 3. **正则匹配**
- 支持复杂的正则表达式匹配
- 适用于模式匹配、高级规则
- 示例：
  ```
  关键词: "价格|价位|多少钱"
  回复: ["不清楚", "看行情", "自己dyor"]
  ```

### ⚙️ 全局设置

- **启用关键词回复**：总开关控制功能
- **随机选择回复**：从多个回复中随机选择
- **未匹配时使用AI回复**：关键词未匹配时的后备策略

### 🎨 界面特性

- **分组管理**：三种匹配模式分别管理
- **动态添加**：点击按钮即可添加新规则
- **批量编辑**：每行一个回复，支持多个回复
- **即时删除**：每条规则都有删除按钮
- **自动保存**：保存到 `keyword_responses.json` 文件

## 🖥️ 界面布局

```
┌─────────────────────────────────────────────────────────┐
│ 关键词回复配置                                           │
├─────────────────────────────────────────────────────────┤
│ 配置关键词自动回复，支持精确匹配、包含匹配和正则匹配      [保存配置] [重新加载] │
├─────────────────────────────────────────────────────────┤
│ 全局设置                                                │
│ ☑ 启用关键词回复                                       │
│ ☑ 随机选择回复                                         │
│ ☑ 未匹配时使用AI回复                                   │
├─────────────────────────────────────────────────────────┤
│ 精确匹配                                               │
│ 用户消息完全匹配关键词时触发                            │
│ [添加精确匹配规则]                                      │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 关键词: [你好____________] [删除]                    │ │
│ │ 回复内容 (每行一个回复):                             │ │
│ │ ┌─────────────────────────────────────────────────┐ │ │
│ │ │ 你好！                                          │ │ │
│ │ │ 嗨！                                            │ │ │
│ │ │ 哈喽                                            │ │ │
│ │ └─────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│ 包含匹配                                               │
│ 用户消息包含关键词时触发                                │
│ [添加包含匹配规则]                                      │
├─────────────────────────────────────────────────────────┤
│ 正则匹配                                               │
│ 支持复杂的正则表达式匹配                                │
│ [添加正则匹配规则]                                      │
└─────────────────────────────────────────────────────────┘
```

## 🚀 使用方法

### 1. 访问配置页面
```bash
# 启动GUI程序
python3 gui_main.py

# 点击"关键词回复"标签页
```

### 2. 添加关键词规则
1. 选择匹配类型（精确/包含/正则）
2. 点击"添加XXX规则"按钮
3. 填写关键词
4. 在文本框中输入回复内容（每行一个）
5. 点击"保存配置"

### 3. 编辑现有规则
- 直接修改关键词输入框
- 在回复文本框中编辑内容
- 点击"删除"按钮移除规则

### 4. 全局设置
- 勾选/取消相关复选框
- 设置会自动保存到配置文件

## 📄 配置文件格式

保存的 `keyword_responses.json` 文件结构：

```json
{
  "description": "关键词自动回复词库配置",
  "rules": {
    "exact_match": {
      "description": "精确匹配",
      "responses": {
        "你好": ["你好！", "嗨！", "哈喽"],
        "再见": ["再见！", "拜拜", "下次见"]
      }
    },
    "contains_match": {
      "description": "包含匹配", 
      "responses": {
        "工作": ["上班族", "搬砖去", "工作辛苦"],
        "钱": ["缺钱", "没钱", "穷", "赚钱不易"]
      }
    },
    "regex_match": {
      "description": "正则匹配",
      "responses": {
        "价格|价位|多少钱": ["不清楚", "看行情", "自己dyor"],
        "买|卖|交易": ["dyor", "自己判断", "风险自负"]
      }
    }
  },
  "settings": {
    "enable_keyword_responses": true,
    "random_response": true,
    "fallback_to_ai": true,
    "match_priority": ["exact_match", "contains_match", "regex_match"]
  }
}
```

## 🔧 技术实现

### 核心组件
- **KeywordConfigWidget**：主配置界面类
- **动态界面生成**：根据JSON数据动态创建规则表单
- **实时数据绑定**：界面更改立即反映到数据结构
- **文件自动管理**：自动加载和保存JSON配置

### 关键方法
```python
# 创建匹配规则组
create_match_group(title, description)

# 添加关键词规则
add_keyword_rule(group, match_type)

# 删除规则
delete_rule(rule_frame, rules_layout)

# 加载配置
load_keywords()

# 保存配置
save_keywords()

# 刷新界面
refresh_ui()
```

### 数据流程
1. **启动加载**：从JSON文件加载现有配置
2. **界面渲染**：根据数据创建规则表单
3. **用户编辑**：通过界面修改规则
4. **数据收集**：将界面数据转换为JSON格式
5. **文件保存**：写入到keyword_responses.json

## 🎯 使用场景

### 1. 基础问候
```
精确匹配：
- "早上好" → ["早", "早安", "早上好呀"]
- "晚上好" → ["晚上好", "晚安", "好晚了"]
- "你好" → ["你好", "哈喽", "hi"]
```

### 2. 话题回复
```
包含匹配：
- "工作" → ["上班族", "搬砖去", "工作辛苦"]
- "吃饭" → ["吃了", "还没呢", "准备吃"]
- "睡觉" → ["早点睡", "晚安", "别熬夜"]
```

### 3. 智能模式
```
正则匹配：
- "价格|价位|多少钱" → ["不清楚", "看行情", "自己dyor"]
- "推荐|建议" → ["自己研究", "不是财务建议", "DYOR"]
- "\d+元|\$\d+" → ["价格变化快", "以实时为准"]
```

## 🔄 与Bot集成

### 自动加载
Bot启动时会自动加载keyword_responses.json配置文件

### 匹配优先级
1. **精确匹配**：优先级最高
2. **包含匹配**：次优先级
3. **正则匹配**：最低优先级
4. **AI回复**：所有关键词都不匹配时使用

### 实时生效
- 修改配置后保存即可生效
- 无需重启Bot程序
- 支持热更新配置

## ✨ 用户体验优化

### 1. 直观操作
- 点击按钮添加规则
- 直接编辑输入框
- 一键删除规则

### 2. 批量管理
- 支持多个回复内容
- 每行一个回复，便于编辑
- 自动去除空行

### 3. 数据验证
- 空关键词不会保存
- 空回复内容不会保存
- 自动过滤无效数据

### 4. 错误处理
- 文件读写异常提示
- JSON格式错误处理
- 界面操作异常保护

## 🎁 附加功能

### 配置备份
- 每次保存都会检查文件完整性
- 保留原始配置文件格式
- 支持手动编辑JSON文件

### 兼容性
- 兼容现有的keyword_responses.json格式
- 向后兼容旧版本配置
- 自动升级配置结构

### 扩展性
- 支持添加新的匹配类型
- 可扩展全局设置选项
- 预留更多配置参数

---

## 🎉 总结

现在你的Discord Bot GUI程序新增了完整的关键词回复配置功能：

### ✅ 主要特性
- **图形化配置**：无需手动编辑JSON文件
- **三种匹配模式**：满足不同使用场景
- **实时编辑**：即时添加/删除/修改规则
- **自动保存**：一键保存到配置文件
- **用户友好**：直观的界面设计

### 🚀 使用流程
1. 启动GUI程序
2. 切换到"关键词回复"标签页
3. 选择匹配类型并添加规则
4. 填写关键词和回复内容
5. 点击保存配置

### 🎯 商业价值
- **降低门槛**：客户无需学习JSON语法
- **提高效率**：图形化操作更快速
- **减少错误**：自动验证和格式化
- **增强体验**：专业的配置界面

**现在客户可以轻松配置各种关键词回复，让Bot更智能、更个性化！** 🎯